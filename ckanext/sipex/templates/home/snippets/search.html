{% set tags = h.get_facet_items_dict('tags', search_facets, limit=5) %}
{% set placeholder = _('Search for data: e.g. planting') %}
{% set dataset_type = h.default_package_type() %}

<div class="module-search card box">
  
  <!-- form action controls what it does after the button is clicked whuch is currently already searching datasets -->
  <form class="module-content search-form" method="get" action="{% url_for dataset_type ~ '.search' %}">
    <div class="search-input form-group search-giant">
      <div class="search-bar-container">
        <input aria-label="{% block header_site_search_label %}{{ h.humanize_entity_type('package', dataset_type, 'search placeholder') or _('Search datasets') }}{% endblock %}" id="field-main-search" type="text" class="form-control search-input-field" name="q" value="" autocomplete="off" placeholder="{% block search_placeholder %}{{ placeholder }}{% endblock %}" />
        
        <div class="button-group">
          <button class="btn search-btn" type="submit" aria-labelledby="search-label">
            <i class="fa fa-search"></i>
            <span class="sr-only" id="search-label">{{ _('Search') }}</span>
          </button>
          
          <button type="button" class="btn info-btn" id="search-info-btn">
            <i class="fa fa-info-circle"></i>
          </button>
        </div>
      </div>
      
      <div class="search-tooltip" id="search-tooltip">
        <div class="tooltip-content">
          <h4>Search Tips</h4>
          <p>Enhance your search using these special operators and techniques:</p>
          
          <table class="search-operators-table">
            <thead>
              <tr>
                <th>Operator</th>
                <th>Function</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>AND</strong></td>
                <td>Returns results containing all specified terms</td>
                <td><code>Douglas AND Fir</code></td>
              </tr>
              <tr>
                <td><strong>OR</strong></td>
                <td>Returns results containing any of the specified terms</td>
                <td><code>Pine OR Spruce</code></td>
              </tr>
              <tr>
                <td><strong>NOT</strong></td>
                <td>Excludes results containing the term after NOT</td>
                <td><code>Forest NOT Fire</code></td>
              </tr>
              <tr>
                <td><strong>" "</strong></td>
                <td>Searches for exact phrase matches</td>
                <td><code>"old growth forest"</code></td>
              </tr>
              <tr>
                <td><strong>( )</strong></td>
                <td>Groups search terms to control search logic</td>
                <td><code>Harvest AND (Pine OR Cedar)</code></td>
              </tr>
              <tr>
                <td><strong>*</strong></td>
                <td>Matches any characters after the root word</td>
                <td><code>Silvi*</code></td>
              </tr>
            </tbody>
          </table>
          
          <p class="search-note">
            <strong>Important:</strong> Operators like AND, OR, and NOT must be typed in UPPERCASE. The search may automatically include related word forms.
          </p>
        </div>
      </div>
    </div>
    
    <!-- refine search button -->
    <div class="refine-search-toggle">
      <button type="button" class="btn btn-link" id="refine-toggle" onclick="toggleRefineSearch()">
        <i class="fa fa-filter"></i> {{ _('Refine Search') }}
        <i class="fa fa-chevron-down" id="refine-chevron"></i>
      </button>
    </div>
    
    <!-- expanded section -->
    <div class="refine-search-section" id="refine-search">
      <h4>{{ _('Refine Search') }}</h4>
      
      <div class="row">
        <!-- col 1 -->
        <div class="col-md-6">
          
          <h6>{{ _('Geographic Area') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="Southern Interior BC">{{ _('Southern Interior BC') }}</option>
              <option value="North Interior BC">{{ _('North Interior BC') }}</option>
              <option value="Central Interior BC">{{ _('Central Interior BC') }}</option>
              <option value="Central Coast BC">{{ _('Central Coast BC') }}</option>
              <option value="North Coast BC">{{ _('North Coast BC') }}</option>
              <option value="South Coast BC">{{ _('South Coast BC') }}</option>
              <option value="Other Canadian Provinces/Territories">{{ _('Other Canadian Provinces/Territories') }}</option>
              <option value="Western USA">{{ _('Western USA') }}</option>
            </select>
          </div>

          <h6>{{ _('Forest Type') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="Coastal">{{ _('Coastal forests') }}</option>
              <option value="Boreal">{{ _('Boreal forests') }}</option>
              <option value="Sub-boreal">{{ _('Sub-boreal forests') }}</option>
              <option value="Dry interior">{{ _('Dry interior forests') }}</option>
              <option value="Montane and subalpine">{{ _('Montane and subalpine') }}</option>
              <option value="Wet interior">{{ _('Wet interior forests') }}</option>
            </select>
          </div>

          <h6>{{ _('BEC Zone') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="CWH">{{ _('CWH = coastal western hemlock') }}</option>
              <option value="CDF">{{ _('CDF =  coastal douglas-fir') }}</option>
              <option value="BWBS">{{ _('BWBS = boreal white and black spruce') }}</option>
              <option value="SWB">{{ _('SWB =  spruce willow birch') }}</option>
              <option value="SBS">{{ _('SBS = sub-boreal spruce') }}</option>
              <option value="SBPS">{{ _('SBPS = sub-boreal pine-spruce') }}</option>
              <option value="IDF">{{ _('IDF = interior douglas-fir') }}</option>
              <option value="PP">{{ _('PP = ponderosa pine') }}</option>
              <option value="MS">{{ _('MS = montane spruce') }}</option>
              <option value="ESSF">{{ _('ESSF = engelmann spruce subalpine fir') }}</option>
              <option value="ICH">{{ _('ICH = interior cedar hemlock') }}</option>
              <option value="MH">{{ _('MH = montane hemlock') }}</option>
            </select>
          </div>

        </div>

        <!-- col 2 -->
        <div class="col-md-6">
          <h6>{{ _('Silviculture Phase') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="Harvest">{{ _('Harvest') }}</option>
              <option value="Reforestation">{{ _('Reforestation') }}</option>
              <option value="Site preparation">{{ _('Site preparation') }}</option>
              <option value="Waste management">{{ _('Waste management') }}</option>
              <option value="Fuel management">{{ _('Fuel management') }}</option>
              <option value="Stand tending">{{ _('Stand tending') }}</option>
              <option value="Adaptive management">{{ _('Adaptive management') }}</option>
              <option value="Restoration">{{ _('Restoration') }}</option>
              <option value="Salvage">{{ _('Salvage') }}</option>
            </select>
          </div>

          <h6>{{ _('Silviculture Techniques') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="Variable retention">{{ _('Variable retention') }}</option>
              <option value="Commercial thinning">{{ _('Commercial thinning') }}</option>
              <option value="Variable density thinning">{{ _('Variable density thinning') }}</option>
              <option value="Spacing">{{ _('Spacing') }}</option>
              <option value="Cultural fire">{{ _('Cultural fire') }}</option>
              <option value="Prescribed fire">{{ _('Prescribed fire') }}</option>
              <option value="Planting">{{ _('Planting') }}</option>
              <option value="Fertilizing">{{ _('Fertilizing') }}</option>
              <option value="Pruning">{{ _('Pruning') }}</option>
              <option value="Brushing">{{ _('Brushing') }}</option>
              <option value="Restoration">{{ _('Restoration') }}</option>
              <option value="Models">{{ _('Models') }}</option>
              <option value="Monitoring">{{ _('Monitoring') }}</option>
            </select>
          </div>

          <h6>{{ _('Values') }}</h6>

          <div class="form-group">
            <select class="form-control" name="tags">
              <option value="">{{ _('All') }}</option>
              <option value="Wildfire risk">{{ _('Wildfire risk') }}</option>
              <option value="Hydrology">{{ _('Hydrology') }}</option>
              <option value="Wildlife">{{ _('Wildlife') }}</option>
              <option value="Cultural plants">{{ _('Cultural plants') }}</option>
              <option value="Biomass">{{ _('Biomass') }}</option>
              <option value="Carbon">{{ _('Carbon') }}</option>
              <option value="Old growth stand structure">{{ _('Old growth stand structure') }}</option>
              <option value="Forest health">{{ _('Forest health') }}</option>
              <option value="Ecosystem health">{{ _('Ecosystem health') }}</option>
              <option value="Climate change resilience">{{ _('Climate change resilience') }}</option>
              <option value="Timber">{{ _('Timber') }}</option>
              <option value="Cultural">{{ _('Cultural') }}</option>
              <option value="Economic">{{ _('Economic') }}</option>
              <option value="Visuals">{{ _('Visuals') }}</option>
            </select>
          </div>

        </div>
      </div>
      
      <!-- Apply and Clear Buttons -->
      <div class="refine-buttons">
        <button type="submit" class="btn btn-primary">
          <i class="fa fa-filter"></i> {{ _('Apply Filters') }}
        </button>
        <button type="button" class="btn btn-secondary" onclick="clearFilters()">
          <i class="fa fa-times"></i> {{ _('Clear Filters') }}
        </button>
      </div>
    </div>
  </form>
  
  <!-- <div class="tags">
    <h3>{{ _('Popular tags') }}</h3>
    {% for tag in tags %}
      <a class="tag" href="{% url_for 'dataset.search', tags=tag.name %}" title="{{ tag.display_name }}">{{ tag.display_name|truncate(22) }}</a>
    {% endfor %}
  </div> -->
</div>